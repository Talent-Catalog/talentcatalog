<!--
  ~ Copyright (c) 2024 Talent Catalog.
  ~
  ~ This program is free software: you can redistribute it and/or modify it under
  ~ the terms of the GNU Affero General Public License as published by the Free
  ~ Software Foundation, either version 3 of the License, or any later version.
  ~
  ~ This program is distributed in the hope that it will be useful, but WITHOUT
  ~ ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  ~ FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero General Public License
  ~ for more details.
  ~
  ~ You should have received a copy of the GNU Affero General Public License
  ~ along with this program. If not, see https://www.gnu.org/licenses/.
  -->

<tc-modal heading="Assign Task to Candidate"
          [showClose]="true"
          [disableAction]="assignForm.invalid || loading || saving"
          actionText="Save"
          (onAction)="onSave()"
>

  <tc-loading [loading]="loading"></tc-loading>

  <div *ngIf="!loading">

    <tc-alert type="danger" *ngIf="error">
      <div><strong>{{error}}</strong></div>
    </tc-alert>

    <form [formGroup]="assignForm">

      <!-- TASKS -->
      <tc-field class="mb-4">
        <tc-label for="task">
          Assign to task:
        </tc-label>
        <ng-select id="task"
                   class="tc-select"
                   [formControlName]="'task'"
                   [items]="allTasks"
                   [groupBy]="'taskType'"
                   [searchFn]="searchTypeOrName"
                   [clearable]="false"
                   placeholder="Select or type to search..."
                   bindLabel="displayName"
        ></ng-select>
      </tc-field>

      <!-- DAYS TO COMPLETE -->
      <tc-description-list *ngIf="selectedTask"
                           [direction]="'column'"
      >
        <tc-description-item label="Description:">
            <span class="fw-light" [innerHtml]="selectedTask.description"></span>
        </tc-description-item>
        <tc-description-item label="Estimated Due Date:">
            <span class="fw-light">
              {{estimatedDueDate | date}} ({{selectedTask?.daysToComplete}} days to complete)
            </span>
        </tc-description-item>
      </tc-description-list>

        <!-- CUSTOM DUE DATE -->
        <tc-field [checkbox]="true">
          <tc-label for="customDate">
            Do you want to set a custom due date?
          </tc-label>
          <tc-input id="customDate"
                    [formControlName]="'customDate'"
                    type="checkbox"
          ></tc-input>
        </tc-field>
          <tc-field *ngIf="assignForm.controls.customDate.value">
              <tc-date-picker id="dueDate"
                              [control]="assignForm.controls.dueDate"
                              [allowPast]="false"
              ></tc-date-picker>
          </tc-field>

    </form>
  </div>

</tc-modal>
