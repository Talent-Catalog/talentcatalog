<nav aria-label="breadcrumb">
  <div class="pull-right">
    <button class="btn btn-primary" [routerLink]="['create']">Add</button>
  </div>
  <ol class="breadcrumb">
    <li class="breadcrumb-item"><a [routerLink]="['/candidates']">Candidates</a></li>
    <li class="breadcrumb-item active" aria-current="page">{{savedSearch ? savedSearch.name : 'Search'}}</li>
  </ol>

</nav>

<div>
  <div class="alert alert-danger" *ngIf="error">
    {{error}}
  </div>
  <form class="form-row" [formGroup]="searchForm" (ngSubmit)="search()">

    <!-- KEYWORD -->
    <div class="form-group col-12 col-md-4">
      <label for="keyword">Keyword</label>
      <input id="keyword" type="text" class="form-control" placeholder="Search..." aria-label="Search"
             formControlName="keyword">
    </div>

    <!-- STATUS -->
    <div class="form-group col-12 col-md-2">
      <label>Status</label>
      <ng-multiselect-dropdown
        name="statuses"
        [placeholder]="''"
        [data]="statuses"
        [settings]="dropdownSettings"
        (onSelect)="onItemSelect($event, 'statuses')"
        (onDeSelect)="onItemDeSelect($event, 'statuses')"
        (onSelectAll)="onSelectAll($event, 'statuses')"
        (onDeSelectAll)="onDeSelectAll('statuses')">
      </ng-multiselect-dropdown>
    </div>

    <!-- OCCUPATION (VETTED) -->
    <!-- TODO 'any | not' -->
    <div class="form-group col-12 col-md-2">
      <label>Occupation
        <small>(TBB vetted)</small>
      </label>
      <input type="text" class="form-control">
    </div>

    <!-- ENGLISH LANGUAGE -->
    <div class="form-group col-12 col-md-2">
      <label>English Proficiency</label>
      <!-- TODO: Grouped select component -->
      <select class="form-control" name="englishLanguage" id="englishLanguage"></select>
    </div>

    <!-- TOGGLE FILTERS -->
    <div class="form-group col-12 col-md-2">
      <button type="button" class="btn btn-outline-primary w-100" (click)="moreFilters = !moreFilters">
        <span *ngIf="!moreFilters">More Filters</span>
        <span *ngIf="moreFilters">Less Filters</span>
      </button>
    </div>

    <ng-container *ngIf="moreFilters">

      <hr class="w-100">

      <!-- OCCUPATION + PROFILE GROUP -->
      <div class="col-12 col-md-3 filter-group">

        <div class="d-flex flex-wrap">

          <!-- OCCUPATION MULTISELECT -->
          <div class="form-group col-12">
            <label>Occupation (candidate specified)</label>
            <ng-multiselect-dropdown
              name="status"
              [placeholder]="''"
              [data]="occupations"
              [settings]="dropdownSettings"
              (onSelect)="onItemSelect($event, 'occupationIds')"
              (onDeSelect)="onItemDeSelect($event, 'occupationIds')"
              (onSelectAll)="onSelectAll($event, 'occupationIds')"
              (onDeSelectAll)="onDeSelectAll('occupationIds')">
            </ng-multiselect-dropdown>
          </div>

          <!-- PROFILE KEYWORD -->
          <div class="form-group col-12">
            <label for="orProfileKeyword">Or profile has any of these words</label>
            <input id="orProfileKeyword" type="text" class="form-control" placeholder="Butcher, Meat, Beef"
                   aria-label="Search" formControlName="orProfileKeyword">
          </div>

        </div>

      </div>

      <div class="col-12 col-md-9">

        <div class="d-flex flex-wrap">

          <!-- AGE -->
          <div class="col-12 col-md-4">

            <div class="d-flex flex-wrap">

              <!-- MIN AGE -->
              <div class="form-group col-6 pl-0">
                <label for="minAge">Min Age</label>
                <input id="minAge" type="number" class="form-control" name="minAge" [formControlName]="'minAge'">
              </div>

              <!-- MAX AGE -->
              <div class="form-group col-6 pr-0">
                <label for="maxAge">Max Age</label>
                <input id="maxAge" type="number" class="form-control" name="maxAge" [formControlName]="'maxAge'">
              </div>
            </div>

          </div>

          <!-- TODO: REGISTERED BETWEEN -->
          <div class="form-group col-12 col-md-4">
            <label for="">Registered On</label>
            <input type="text" class="form-control">
          </div>

          <!-- TODO: MODIFIED BETWEEN -->
          <div class="form-group col-12 col-md-4">
            <label for="">Last Modified</label>
            <input type="text" class="form-control">
          </div>

          <!-- COUNTRIES  -->
          <div class="form-group col-12 col-md-4">
            <label>Country</label>
            <ng-multiselect-dropdown
              name="country"
              [data]="countries"
              [settings]="dropdownSettings"
              (onSelect)="onItemSelect($event, 'countryIds')"
              (onDeSelect)="onItemDeSelect($event, 'countryIds')"
              (onSelectAll)="onSelectAll($event, 'countryIds')"
              (onDeSelectAll)="onDeSelectAll('countryIds')">
            </ng-multiselect-dropdown>
          </div>

          <!-- TODO EDUCATION LEVEL -->
          <div class="form-group col-12 col-md-4">
            <label for="minEducationLevelId">Education Level (minimum)</label>
            <select class="form-control" id="minEducationLevelId" name="minEducationLevelId"
                    [formControlName]="'minEducationLevelId'">
              <option value=""></option>
              <option *ngFor="let candidateEducation of educationLevels" [value]="candidateEducation.id">
                {{candidateEducation.label}}
              </option>
            </select>
          </div>

          <!-- TODO EDUCATION MAJOR -->
          <div class="form-group col-12 col-md-4">
            <label for="">Education major (minimum)</label>
            <input type="text" class="form-control">
          </div>

        </div>

      </div>

      <!-- TODO OTHER LANGUAGE -->
      <div class="form-group col-12 col-md-3">
        <label for="">Other Language</label>
        <input type="text" class="form-control">
      </div>

      <!-- TODO NATIONALITY -->
      <div class="form-group col-12 col-md-3">
        <label>Nationality</label>
        <!-- TODO 'any | not' -->
        <ng-multiselect-dropdown
          name="selectedNationalities"
          [placeholder]="'Select Nationalities'"
          [data]="nationalities"
          [settings]="dropdownSettings"
          (onSelect)="onItemSelect($event, 'nationalityIds')"
          (onDeSelect)="onItemDeSelect($event, 'nationalityIds')"
          (onSelectAll)="onSelectAll($event, 'nationalityIds')"
          (onDeSelectAll)="onDeSelectAll('nationalityIds')">
        </ng-multiselect-dropdown>
      </div>

      <!-- GENDER -->
      <div class="form-group col-12 col-md-3">
        <label for="gender">Gender</label>
        <select class="form-control" name="gender" id="gender" [formControlName]="'gender'">
          <option value=""></option>
          <option value="female">Female</option>
          <option value="male">Male</option>
          <option value="other">Other</option>
        </select>
      </div>

      <!-- UN REGISTERED - removed for now -->
      <!--      <div class="form-group col-12 col-md-3">-->
      <!--        <label for="unRegistered">UN Registered</label>-->
      <!--        <select class="form-control" name="unRegistered" id="unRegistered" [formControlName]="'unRegistered'">-->
      <!--          <option value=""></option>-->
      <!--          <option [value]="true">Yes</option>-->
      <!--          <option [value]="false">No</option>-->
      <!--        </select>-->
      <!--      </div>-->

      <hr class="w-100">

      <div class="col-12">
        <span>Joined Searches</span>
        <div class="pull-right">
          <button class="btn btn-primary" (click)="addSavedSearchJoin()">Add</button>
        </div>
      </div>

      <!-- SEARCH JOINS -->
      <ng-container *ngFor="let join of searchForm.value.searchJoinRequests">
        <div class="form-group col-2">
          <div class="form-control">
            {{join.searchType}}
          </div>
        </div>
        <div class="form-group col-6 offset-4">
          <div class="form-control">
            {{join.name}}
          </div>
        </div>
      </ng-container>


      <hr class="w-100">
    </ng-container>
    <div class="col-6">
      <div class="btn-group" role="group">
        <button class="btn btn-outline-dark" (click)="showSavedSearches()">Load Saved Search</button>
        <button class="btn btn-outline-dark" (click)="showSave()">Save Search</button>
      </div>
    </div>

    <div class="col-6">
      <div class="d-flex justify-content-end">
        <button class="btn btn-outline-dark"
                [disabled]="loading"
                (click)="clear()">Clear
        </button>
        <button class="btn btn-primary"
                [disabled]="loading"
                (click)="search()">Apply
        </button>
      </div>
    </div>


  </form>

  <div class="filter-results text-muted">
    <span>Found {{results?.totalElements}} candidates</span>

    <ngb-pagination [boundaryLinks]="true"
                    [pageSize]="pageSize"
                    [collectionSize]="results?.totalElements"
                    [(page)]="pageNumber"
                    (pageChange)="search()">
    </ngb-pagination>
  </div>

  <div class="split-view" [class.show]="!!selectedCandidate">

    <div class="table-wrapper">
      <table class="table">

        <thead>
        <tr>
          <th class="w-25">Candidate #</th>
          <th>First Name</th>
          <th>Last Name</th>
        </tr>
        </thead>

        <tbody>
        <tr *ngFor="let candidate of results?.content">
          <td class="candidate-number">
            <a (click)="viewCandidate(candidate)">
              {{candidate.candidateNumber}}
            </a>
          </td>
          <td>{{candidate.user.firstName}}</td>
          <td>{{candidate.user.lastName}}</td>
        </tr>

        <!-- loading -->
        <tr *ngIf="loading">
          <td colspan="42">
            <i class="fa fa-spinner fa-spin"></i> Loading...
          </td>
        </tr>

        <!-- no results -->
        <tr *ngIf="!loading && !results?.totalElements">
          <td colspan="42">
            <span class="text-muted">(no matching candidates)</span>
          </td>
        </tr>

        </tbody>

      </table>
    </div>

    <app-candidate-search-card class="profile"
                               [candidate]="selectedCandidate"
                               (onClose)="selectedCandidate = null">
    </app-candidate-search-card>

  </div>
