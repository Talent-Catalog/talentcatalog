<!--
  ~ Copyright (c) 2024 Talent Catalog.
  ~
  ~ This program is free software: you can redistribute it and/or modify it under
  ~ the terms of the GNU Affero General Public License as published by the Free
  ~ Software Foundation, either version 3 of the License, or any later version.
  ~
  ~ This program is distributed in the hope that it will be useful, but WITHOUT
  ~ ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  ~ FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero General Public License
  ~ for more details.
  ~
  ~ You should have received a copy of the GNU Affero General Public License
  ~ along with this program. If not, see https://www.gnu.org/licenses/.
  -->

<!-- LOADING -->
<div class="my-4">
  <tc-loading [loading]="loading"></tc-loading>
</div>

<tc-alert type="danger" *ngIf="error">
  <div><strong>{{error}}</strong></div>
</tc-alert>

<ng-container *ngIf="!loading">
  <div class="mb-4 d-flex justify-content-between align-items-center">
    <!-- ORDER BY -->
    <tc-dropdown>
      <tc-dropdown-button [type]="'outline'">
        Order By {{orderOccupation ? 'Occupation' : 'Date'}}
        <i class="fas fa-chevron-down"></i>
      </tc-dropdown-button>
      <tc-dropdown-menu>
        <tc-dropdown-item (click)="orderOccupation = true">
          Occupation
        </tc-dropdown-item>
        <tc-dropdown-item (click)="orderOccupation = false">
          Date
        </tc-dropdown-item>
      </tc-dropdown-menu>
    </tc-dropdown>

    <!-- CREATE OCCUPATION BTN-->
    <div *ngIf="editable && adminUser">
      <tc-button (onClick)="createCandidateOccupation()"
                 [type]="'solid'"
      >
        <i class="fas fa-plus"></i>
        Occupation
      </tc-button>
    </div>
  </div>

  <!-- OCCUPATION VIEW -->
  <ng-container *ngIf="orderOccupation">

    <app-view-candidate-job-experience *ngFor="let occupation of candidate?.candidateOccupations"
                                       [candidate]="candidate"
                                       [candidateOccupation]="occupation"
                                       [editable]="editable"
                                       [adminUser]="adminUser"
                                       (deleteOccupation)="deleteCandidateOccupation($event)">
    </app-view-candidate-job-experience>

  </ng-container>

  <!-- EXPERIENCE VIEW -->
  <ng-container *ngIf="!orderOccupation">

    <tc-card class="mb-4" *ngFor="let experience of candidate?.candidateJobExperiences">

      <!-- HEADER -->
      <tc-card-header>
        <span>{{experience.role}}</span>

        <div class="float-end" *ngIf="editable">
          <tc-button (onClick)="editCandidateJobExperience(experience)"
                     [type]="'plain'"
                     [color]="'secondary'"
          >
            <i class="fas fa-edit"></i>
          </tc-button>
        </div>
      </tc-card-header>

      <!-- BODY -->

        <div class="row">
          <!-- DESCRIPTION -->
          <div class="col-12" *ngIf="experience.description" [innerHtml]="experience.description">
          </div>

          <!-- COMPANY DETAILS -->
          <div class="col-12">
            <span>{{experience.companyName}}, {{experience.country.name}}</span>
          </div>

          <!-- DATES -->
          <div class="col-12">
            <span class="text-muted small">{{experience.startDate | date }} - {{experience.endDate | date }}</span>
          </div>

        </div>

    </tc-card>

  </ng-container>

</ng-container>

