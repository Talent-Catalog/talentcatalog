<!--
  ~ Copyright (c) 2024 Talent Catalog.
  ~
  ~ This program is free software: you can redistribute it and/or modify it under
  ~ the terms of the GNU Affero General Public License as published by the Free
  ~ Software Foundation, either version 3 of the License, or any later version.
  ~
  ~ This program is distributed in the hope that it will be useful, but WITHOUT
  ~ ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  ~ FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero General Public License
  ~ for more details.
  ~
  ~ You should have received a copy of the GNU Affero General Public License
  ~ along with this program. If not, see https://www.gnu.org/licenses/.
  -->

<tc-modal heading="Add attachment"
          [showClose]="true"
          [disableAction]="uploading"
          (onAction)="type === 'file' ? close() : save()"
          [actionText]="type === 'file' ? 'Close' : 'Save'"
          [showCancel]="type !== 'file'"
>

  <tc-alert type="danger" *ngIf="error">
    <div><strong>{{error}}</strong></div>
  </tc-alert>

  <form [formGroup]="form">

    <ng-container *ngIf="type === 'link'">

      <tc-field class="mb-4">
        <tc-label for="name">
          Attachment Name
        </tc-label>
        <tc-input id="name"
                  [formControlName]="'name'"
                  type="text"
        ></tc-input>
      </tc-field>

      <div class="mb-4">
        <tc-label for="location">
          Attachment URL
        </tc-label>
        <div>
          <small class="text-muted">Please include the leading protocol (http:// or https://)</small>
        </div>
        <tc-input id="location"
                  [formControlName]="'location'"
                  type="text"
                  placeholder="https://www.example.com/path/to/file"
        ></tc-input>
      </div>

    </ng-container>

    <ng-container *ngIf="type === 'file'">

      <tc-loading [loading]="uploading"></tc-loading>

      <tc-alert type="success"
                *ngIf="attachments?.length"
      >
        Successfully uploaded {{attachments.length}}
        <span *ngIf="form.value?.cv">CV</span> attachment<span *ngIf="attachments.length > 1">s</span>
      </tc-alert>

      <tc-field [checkbox]="true"
                class="mb-4"
                *ngIf="!attachments?.length && !uploading"
      >
          <tc-label for="cv">
            Is this file a CV?
          </tc-label>
          <tc-input id="cv"
                    [formControlName]="'cv'"
                    [value]="'cv'"
                    type="checkbox"
          ></tc-input>
      </tc-field>
      <div *ngIf="type === 'file'" class="form-text">
        If file is a CV then its text will be checked in keyword searches.
      </div>

      <app-file-upload *ngIf="!attachments?.length && !uploading"
                       (error)="onError($event)"
                       (newFiles)="startServerUpload($event)"></app-file-upload>


    </ng-container>
  </form>
</tc-modal>
