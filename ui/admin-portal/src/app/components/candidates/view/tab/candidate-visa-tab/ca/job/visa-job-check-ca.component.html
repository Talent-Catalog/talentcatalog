<!--
  ~ Copyright (c) 2024 Talent Catalog.
  ~
  ~ This program is free software: you can redistribute it and/or modify it under
  ~ the terms of the GNU Affero General Public License as published by the Free
  ~ Software Foundation, either version 3 of the License, or any later version.
  ~
  ~ This program is distributed in the hope that it will be useful, but WITHOUT
  ~ ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  ~ FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero General Public License
  ~ for more details.
  ~
  ~ You should have received a copy of the GNU Affero General Public License
  ~ along with this program. If not, see https://www.gnu.org/licenses/.
  -->

<!-- ERROR -->
<tc-alert *ngIf="error">{{error}}</tc-alert>

<tc-accordion *ngIf="selectedJobCheck" #visaJobCanada>
  <tc-accordion-item id="occupation-eligibility" header="Occupation Eligibility">
    <app-occupation-category
      [visaJobCheck]="selectedJobCheck"
      [entity]="visaCheckRecord">
    </app-occupation-category>
    <app-occupation-subcategory
      [visaJobCheck]="selectedJobCheck"
      [entity]="visaCheckRecord">
    </app-occupation-subcategory>
    <hr>
    <div class="card card-body intake-data">
      <app-fixed-input
        [question]="'Job location'"
        [answer]="selectedJobCheck?.jobOpp?.jobOppIntake?.location">
      </app-fixed-input>
      <app-fixed-input
        [question]="'Job location details'"
        [answer]="selectedJobCheck?.jobOpp?.jobOppIntake?.locationDetails">
      </app-fixed-input>
      <small class="text-center text-muted">All job information can be found on the job's page - to view click the linked job name under Job Specific Assessment above.</small>
    </div>
  </tc-accordion-item>

  <tc-accordion-item id="pathway-eligibility">
    <div custom-header>
      <p class="mb-0">Pathway Eligibility
        <span class="small fw-light fst-italic">
        <a [href]="pathwaysInfoLink" target="_blank">
          (For more information on the pathways click here <i class="fas fa-external-link-alt" title="Show in new tab"></i>)
        </a>
      </span>
      </p>
    </div>
    <app-preferred-pathways
      [visaJobCheck]="selectedJobCheck"
      [entity]="visaCheckRecord">
    </app-preferred-pathways>
    <app-eligible-pathways
      [visaJobCheck]="selectedJobCheck"
      [entity]="visaCheckRecord">
    </app-eligible-pathways>
    <app-ineligible-pathways
      [visaJobCheck]="selectedJobCheck"
      [entity]="visaCheckRecord">
    </app-ineligible-pathways>
  </tc-accordion-item>

  <tc-accordion-item id="candidate-qualifications" header="Candidate Qualifications">
      <div>
        <app-relevant-work-exp
          [visaJobCheck]="selectedJobCheck"
          [entity]="visaCheckRecord">
        </app-relevant-work-exp>
        <app-age-requirement
          [visaJobCheck]="selectedJobCheck"
          [entity]="visaCheckRecord">
        </app-age-requirement>
        <app-language-threshold
          [visaJobCheck]="selectedJobCheck"
          [entity]="visaCheckRecord">
        </app-language-threshold>
        <app-qualification-relevant
          [visaJobCheck]="selectedJobCheck"
          [entity]="visaCheckRecord">
        </app-qualification-relevant>
      </div>
      <hr>
      <div class="card card-body intake-data">
        <div>
          <div class="card-title">Experience</div>
          <!-- Display All Candidate Experience   -->
          <div *ngIf="candOccupations?.length > 0">
            <ul>
              <li class="display" *ngFor="let co of candOccupations" >
                <app-fixed-input
                  *ngIf="co.occupation"
                  [question]="co.occupation?.name"
                  [answer]="co.yearsExperience.toString() + ' years'">
                </app-fixed-input>
                <app-fixed-input
                  *ngIf="co.occupation == null && co.migrationOccupation"
                  [question]="co.migrationOccupation"
                  [answer]="co.yearsExperience.toString() + ' years'">
                </app-fixed-input>
              </li>
            </ul>
          </div>
          <div *ngIf="candOccupations?.length == 0">
            <p>No experience entered</p>
          </div>
          <hr>
        </div>
        <div>
          <div class="card-title">Language exams</div>
          <div *ngIf="candidateIntakeData?.candidateExams?.length > 0; else noLang">
            <ul>
              <li *ngFor="let ce of candidateIntakeData.candidateExams; let i = index;">
                <p class="mb-0">{{ce?.exam}}<span *ngIf="ce.otherExam">, </span>{{ce.otherExam}}: {{ce?.score}}<span *ngIf="ce.year"> ({{ce?.year}})</span>
                </p>
              </li>
            </ul>
          </div>
          <ng-template #noLang>
            <p>No exams entered</p>
          </ng-template>

          <div class="card-title">Estimated IELTS Score: <span>{{candidateIntakeData?.englishAssessmentScoreIelts}}</span></div>
          <div class="card-title">Partner IELTS Score: <span>{{candidateIntakeData?.partnerIeltsScore}}</span></div>
          <hr>
        </div>
        <div>
          <div class="card-title">Education</div>
          <!-- Display All Candidate Qualifications   -->
          <div *ngIf="candQualifications?.length > 0; else noQual">
            <ul>
              <li class="display" *ngFor="let edu of candQualifications">
                <app-fixed-input
                  *ngIf="edu.educationMajor"
                  [question]="edu.educationMajor?.name + ' ' + edu.courseName"
                  [answer]="edu.educationType">
                </app-fixed-input>
                <app-fixed-input
                  *ngIf="edu.educationMajor == null && edu.courseName"
                  [question]="edu.courseName"
                  [answer]="edu.educationType">
                </app-fixed-input>
              </li>
            </ul>
          </div>
          <ng-template #noQual>
            <p>No qualifications entered</p>
          </ng-template>
        </div>
      </div>
  </tc-accordion-item>

  <tc-accordion-item id="tbb-eligibility" header="TC Eligibility">
    <div>
      <app-job-interest
        [visaJobCheck]="selectedJobCheck"
        [entity]="visaCheckRecord">
      </app-job-interest>
      <app-job-eligibility-assessment
        [visaJobCheck]="selectedJobCheck"
        [entity]="visaCheckRecord">
      </app-job-eligibility-assessment>
    </div>
    <hr>
    <div class="card card-body intake-data">
      <app-fixed-input
        [question]="'Family in Canada that may impact offer'"
        [answer]="familyInCanada">
      </app-fixed-input>
    </div>
  </tc-accordion-item>

  <tc-accordion-item id="family-assessment" header="Family Assessment">
    <div>
      <app-relocating-dependants
        [candidateOpp]="candidateOpportunity"
        [candidateId]="candidate.id">
      </app-relocating-dependants>
    </div>
    <div class="card card-body intake-data">
      <app-fixed-input [question]="'Marital status'" [answer]="candidateIntakeData?.maritalStatus"></app-fixed-input>
      <app-fixed-input [question]="'Spouse\'s highest level education'" [answer]="candidateIntakeData?.partnerEduLevel?.name"></app-fixed-input>
      <app-fixed-input [question]="'Did spouse take IELTS?'" [answer]="partnerIeltsString"></app-fixed-input>
      <hr>
      <div>
        <div class="card-title">Dependant Family</div>
        <app-dependants
          [candidateIntakeData]="candidateIntakeData"
          [candidate]="candidate"
          [editable]="false"
        ></app-dependants>
      </div>
    </div>
  </tc-accordion-item>

  <tc-accordion-item id="final-assessment" header="Final Assessment">
    <app-visa-job-put-forward
      [visaJobCheck]="selectedJobCheck"
      [entity]="visaCheckRecord">
    </app-visa-job-put-forward>
    <app-visa-job-notes
      [visaJobCheck]="selectedJobCheck"
      [entity]="visaCheckRecord">
    </app-visa-job-notes>
  </tc-accordion-item>
</tc-accordion>
