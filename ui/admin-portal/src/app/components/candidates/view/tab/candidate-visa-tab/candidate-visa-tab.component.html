<!--
  ~ Copyright (c) 2021 Talent Beyond Boundaries.
  ~
  ~ This program is free software: you can redistribute it and/or modify it under
  ~ the terms of the GNU Affero General Public License as published by the Free
  ~ Software Foundation, either version 3 of the License, or any later version.
  ~
  ~ This program is distributed in the hope that it will be useful, but WITHOUT
  ~ ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  ~ FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero General Public License
  ~ for more details.
  ~
  ~ You should have received a copy of the GNU Affero General Public License
  ~ along with this program. If not, see https://www.gnu.org/licenses/.
  -->

<div *ngIf="loading">
  <i class="fas fa-spinner fa-spin"></i> loading...
</div>
<div *ngIf="error">
  {{error}}
</div>

<div *ngIf="!loading" id="VisaIntakes">
  <div class="d-flex justify-content-between mb-2 ms-2">
    <div class="d-flex flex-column">
      <h5>Visa Eligibility Checks</h5>
    </div>

    <div class="float-end" *ngIf="!loading">
      <button type="button" class="btn btn-primary btn-sm" (click)="addRecord()">
        <i class="fas fa-plus"></i> Add Country
      </button>
    </div>
  </div>

  <div *ngIf="candidateIntakeData?.candidateVisaChecks.length == 0">
    <p class="small text-muted text-center fw-light">No visa checks added - add a country to begin</p>
  </div>
</div>

<div class="row" *ngIf="!loading">
  <div class="mx-auto col-10 col-md-8 col-lg-6">
    <form [formGroup]="form">
      <div *ngFor="let visaCheck of visaChecks; let i = index;">
        <div class="form-check">
          <input class="form-check-input" type="radio" [value]="i" name="visaCountry" [id]="'radio'+i"
                 [formControlName]="'visaCountry'" (change)="changeVisaCountry($event)">
          <label class="form-check-label fw-light" [for]="'radio'+i">{{visaCheck?.country?.name}}</label>
          <a class="link-secondary float-end" (click)="deleteRecord(i)"><i class="fas fa-trash"></i></a>
        </div>
      </div>
    </form>
  </div>
</div>

<hr *ngIf="candidateIntakeData?.candidateVisaChecks.length > 0">

<!--todo Not sure where exportAsPdf should be calling-->
<!--<button class="btn btn-primary" (click)="exportAsPdf('VisaCheck')" [disabled]="saving">-->
<!--  <i *ngIf="saving" class="fas fa-spinner fa-spin" ></i>-->
<!--  Export PDF-->
<!--</button>-->

<div [ngSwitch]="selectedCountry" *ngIf="selectedCountry != undefined && !loading" id="VisaCheck">
  <app-visa-check-au *ngSwitchCase="'Australia'"
                     [candidate]="candidate"
                     [visaCheckRecord]="getVisaCheckCountryRecord()"
                     [candidateIntakeData]="candidateIntakeData">
  </app-visa-check-au>

  <app-visa-check-ca *ngSwitchCase="'Canada'"
                     [candidate]="candidate"
                     [visaCheckRecord]="getVisaCheckCountryRecord()"
                     [candidateIntakeData]="candidateIntakeData">
  </app-visa-check-ca>

  <app-visa-check-nz *ngSwitchCase="'New Zealand'"
                     [candidate]="candidate"
                     [candidateIntakeData]="candidateIntakeData">
  </app-visa-check-nz>

  <app-visa-check-uk *ngSwitchCase="'United Kingdom'"
                     [candidate]="candidate"
                     [candidateIntakeData]="candidateIntakeData">
  </app-visa-check-uk>

  <div *ngSwitchDefault>
    //todo error!
    {{selectedCountry}}
  </div>
</div>


