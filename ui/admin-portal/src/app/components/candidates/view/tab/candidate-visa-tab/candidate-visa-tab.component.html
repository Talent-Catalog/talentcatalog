<!--
  ~ Copyright (c) 2024 Talent Catalog.
  ~
  ~ This program is free software: you can redistribute it and/or modify it under
  ~ the terms of the GNU Affero General Public License as published by the Free
  ~ Software Foundation, either version 3 of the License, or any later version.
  ~
  ~ This program is distributed in the hope that it will be useful, but WITHOUT
  ~ ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  ~ FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero General Public License
  ~ for more details.
  ~
  ~ You should have received a copy of the GNU Affero General Public License
  ~ along with this program. If not, see https://www.gnu.org/licenses/.
  -->

<tc-loading [loading]="loading"></tc-loading>
<tc-alert *ngIf="error">{{error}}</tc-alert>

<div *ngIf="!loading" id="VisaIntakes">
  <div class="row align-items-center">
    <div class="col align-self-start">
      <h5 class="mb-3">Visa Eligibility Checks</h5>
    </div>
    <div class="row">
      <form [formGroup]="form">
        <div class="d-flex flex-column gap-3">
          <div *ngFor="let visaCheck of visaChecks; let i = index">
              <tc-radio [id]="'radio' + i"
                        name="visaCountry"
                        [value]="i"
                        [label]="visaCheck.country.name"
                        [formControlName]="'visaCountry'"
                        (change)="reloadAndSelectVisaCheck(i)"
              >
                <tc-icon *ngIf="canDeleteVisa() && isEditable()"
                         type="button" color="gray"
                         class="ms-3"
                         (click)="deleteRecord(i)">
                  <i class="fas fa-trash"></i>
                </tc-icon>
              </tc-radio>
          </div>
        </div>
      </form>
    </div>
    <div class="d-flex justify-content-end gap-2">
      <app-export-pdf *ngIf="visaChecks?.length > 0"
                      [candidate]="candidate"
                      [idToExport]="'VisaCheck'"
      ></app-export-pdf>
      <tc-button *ngIf="isEditable()" class="float-end" size="sm" (onClick)="addRecord()">
        <i class="fas fa-plus"></i>
        Add Country
      </tc-button>
    </div>
  </div>

  <div *ngIf="visaChecks?.length == 0">
    <p class="paragraph-sm text-color-caption text-center">No visa checks added - add a country to begin</p>
  </div>
</div>

<hr *ngIf="!loading && visaChecks?.length > 0">

<div [ngSwitch]="selectedCountry" *ngIf="selectedVisaCheck != undefined && !loading" id="VisaCheck">
  <app-visa-check-au *ngSwitchCase="'Australia'"
                     [candidate]="candidate"
                     [visaCheckRecord]="selectedVisaCheck"
                     [candidateIntakeData]="candidateIntakeData">
  </app-visa-check-au>

  <app-visa-check-ca *ngSwitchCase="'Canada'"
                     [candidate]="candidate"
                     [visaCheckRecord]="selectedVisaCheck"
                     [candidateIntakeData]="candidateIntakeData">
  </app-visa-check-ca>

  <app-visa-check-nz *ngSwitchCase="'New Zealand'"
                     [candidate]="candidate"
                     [candidateIntakeData]="candidateIntakeData">
  </app-visa-check-nz>

  <app-visa-check-uk *ngSwitchCase="'United Kingdom'"
                     [candidate]="candidate"
                     [visaCheckRecord]="selectedVisaCheck"
                     [candidateIntakeData]="candidateIntakeData">
  </app-visa-check-uk>

  <div *ngSwitchDefault>
    //todo error!
    {{selectedCountry}}
  </div>
</div>


