<!--
  ~ Copyright (c) 2024 Talent Catalog.
  ~
  ~ This program is free software: you can redistribute it and/or modify it under
  ~ the terms of the GNU Affero General Public License as published by the Free
  ~ Software Foundation, either version 3 of the License, or any later version.
  ~
  ~ This program is distributed in the hope that it will be useful, but WITHOUT
  ~ ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  ~ FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero General Public License
  ~ for more details.
  ~
  ~ You should have received a copy of the GNU Affero General Public License
  ~ along with this program. If not, see https://www.gnu.org/licenses/.
  -->
<tc-modal [heading]="title"
          actionText="Save"
          (onAction)="onSave()"
          [disableAction]="userForm.invalid || working"
          [showClose]="true"
>

  <tc-loading [loading]="working"></tc-loading>

  <div *ngIf="!working">
    <tc-alert *ngIf="error">{{error}}</tc-alert>

    <form [formGroup]="userForm">
      <tc-fieldset>
        <tc-field>
          <tc-label for="email">Email *</tc-label>
          <tc-input type="email" id="email" formControlName="email" pattern="{{emailRegex}}"></tc-input>
          <tc-error-message *ngIf="userForm.get('email').touched || userForm.get('email').dirty
          && userForm.get('email').errors?.['pattern']">
            Please enter valid email address
          </tc-error-message>
        </tc-field>

        <tc-field>
          <tc-label for="username">Username *</tc-label>
          <tc-input type="text" id="username" formControlName="username"></tc-input>
        </tc-field>


        <tc-field *ngIf="create">
          <tc-label for="password">Password *</tc-label>
          <tc-input type="text" id="password" formControlName="password"></tc-input>
        </tc-field>
        <tc-field>
          <tc-label for="firstName">First Name *</tc-label>
          <tc-input type="text" id="firstName" formControlName="firstName"></tc-input>
        </tc-field>
        <tc-field>
          <tc-label for="lastName">Last Name *</tc-label>
          <tc-input type="text" id="lastName" formControlName="lastName"></tc-input>
        </tc-field>

        <!-- Partner  -->
        <tc-field *ngIf="canAssignPartner()">
          <tc-label>Partner *</tc-label>
          <ng-select
            id="partner"
            class="tc-select"
            [items]="partners"
            [multiple]="false"
            [closeOnSelect]="true"
            [searchable]="true"
            placeholder="Select or type..."
            bindLabel="name"
            bindValue="id"
            [formControlName]="'partnerId'">
          </ng-select>
        </tc-field>

        <tc-field *ngIf="!create">
          <tc-label for="status">Status</tc-label>
          <ng-select id="status" class="tc-select" [formControlName]="'status'" placeholder="Select">
            <ng-option value="active">Active</ng-option>
            <ng-option value="inactive">Inactive</ng-option>
          </ng-select>
        </tc-field>

        <tc-field>
          <tc-label for="role">Role *</tc-label>
          <ng-select
            id="role"
            class="tc-select"
            [items]="roleOptions"
            [formControlName]="'role'"
            [clearable]="false"
            placeholder="Select"
            bindValue="key"
            bindLabel="stringValue">
          </ng-select>
        </tc-field>

        <tc-field [checkbox]="true">
          <tc-label for="jobCreator">Job Creator?</tc-label>
          <tc-input type="checkbox" id="jobCreator" formControlName="jobCreator"></tc-input>
        </tc-field>

        <!-- Approver if required â€” will be a TC admin user -->
        <tc-field>
          <tc-label>Approver</tc-label>
          <ng-select
            id="approver"
            class="tc-select"
            [items]="approvers"
            [multiple]="false"
            [closeOnSelect]="true"
            [searchable]="true"
            placeholder="Select or type..."
            bindLabel="firstName"
            bindValue="id"
            [formControlName]="'approverId'">
            <!-- MODEL concatenate two properties for display in form - Enables viewing and searching potential approvers (admin users) by full name -->
            <ng-template ng-label-tmp let-item="item">
              {{item.firstName}} {{item.lastName}}
            </ng-template>
            <ng-template ng-option-tmp let-item="item" let-search="searchTerm">
              {{item.firstName}} {{item.lastName}}
            </ng-template>
          </ng-select>
          <tc-description>
            If required, who approved this registration?
          </tc-description>
        </tc-field>

        <!-- If approval was required for this user registration, what was the reason given? -->
        <tc-field>
          <tc-label for="purpose">Purpose</tc-label>
          <tc-input type="text" id="purpose" formControlName="purpose"></tc-input>
          <tc-description>What is the reason for their TC use?</tc-description>
        </tc-field>

        <!-- SOURCE COUNTRIES  -->
        <tc-field>
          <tc-label>Source Country</tc-label>
          <ng-select
            id="sourceCountry"
            class="tc-select"
            [items]="countries"
            [multiple]="true"
            [closeOnSelect]="false"
            [searchable]="true"
            placeholder="Select or type..."
            bindLabel="name"
            [formControlName]="'sourceCountries'">
          </ng-select>
          <tc-description>Leave blank if there are no restrictions, otherwise add one or more countries to which admin is restricted.</tc-description>
        </tc-field>

        <tc-field [checkbox]="true">
          <tc-label for="readOnly">Read Only?</tc-label>
          <tc-input type="checkbox" id="readOnly" formControlName="readOnly"></tc-input>
        </tc-field>

        <tc-field [checkbox]="true">
          <tc-label for="usingMfa">Authentication app?</tc-label>
          <tc-input type="checkbox" id="usingMfa" formControlName="usingMfa"></tc-input>
        </tc-field>
      </tc-fieldset>
    </form>
  </div>
</tc-modal>
