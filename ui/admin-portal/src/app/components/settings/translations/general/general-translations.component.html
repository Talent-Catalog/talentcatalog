<!--
  ~ Copyright (c) 2024 Talent Catalog.
  ~
  ~ This program is free software: you can redistribute it and/or modify it under
  ~ the terms of the GNU Affero General Public License as published by the Free
  ~ Software Foundation, either version 3 of the License, or any later version.
  ~
  ~ This program is distributed in the hope that it will be useful, but WITHOUT
  ~ ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  ~ FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero General Public License
  ~ for more details.
  ~
  ~ You should have received a copy of the GNU Affero General Public License
  ~ along with this program. If not, see https://www.gnu.org/licenses/.
  -->
<tc-loading [loading]="loading"></tc-loading>

<div *ngIf="!loading" class="main container">
    <div class="header">
      <h4>General Translations</h4>
      <div>
        <tc-button id="save-translations" *ngIf="isAnAdmin() && !loggedInUser.readOnly"
                (onClick)="save()" [disabled]="saving || error || saveError">Save</tc-button>
      </div>
    </div>
    <tc-alert *ngIf="saveError">
      Sorry, there was an error saving this file:
      <div>
        {{saveError | json}}
      </div>
    </tc-alert>
    <tc-alert *ngIf="error">
      Sorry, there was an error loading this file:
      <div>
        {{error | json}}
      </div>
    </tc-alert>
    <div class="filter">
      <div class="row">
        <div class="col-sm-6">
          <ng-select class="tc-select" [items]="languages" (change)="setLanguage($event)" [clearable]="false" [ngModel]="systemLanguage">
          </ng-select>
        </div>
        <div class="col-sm-6">
          <ng-select class="tc-select" [items]="keys" [placeholder]="'Filter by a specific field group'" [clearable]="true" (change)="filterItems($event)">
          </ng-select>
        </div>
      </div>
    </div>

    <tc-table [results]="fields"
              [loading]="loading"
              [clickableRows]="false"
    >
      <thead>
      <tr>
        <th>Field</th>
        <th>Translation</th>
      </tr>
      </thead>
      <tbody>
      <ng-container  *ngFor="let field of fieldsFiltered">
        <tr [class.is-blank]="isBlank(field.value)">
          <td style="width: 200px">
            {{field.path}}
          </td>
          <td>
            <textarea rows="3" class="form-control form-control-sm" [(ngModel)]="field.value" [disabled]="loggedInUser.readOnly"></textarea>
          </td>
        </tr>
      </ng-container>
      </tbody>
    </tc-table>

    <tc-button class="position-fixed bottom-0 end-0 m-3" (onClick)="scrollToTop()">
         <i class="fas fa-chevron-up"></i>
    </tc-button>
</div>
