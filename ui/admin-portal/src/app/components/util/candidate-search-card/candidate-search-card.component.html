<!--
  ~ Copyright (c) 2024 Talent Catalog.
  ~
  ~ This program is free software: you can redistribute it and/or modify it under
  ~ the terms of the GNU Affero General Public License as published by the Free
  ~ Software Foundation, either version 3 of the License, or any later version.
  ~
  ~ This program is distributed in the hope that it will be useful, but WITHOUT
  ~ ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  ~ FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero General Public License
  ~ for more details.
  ~
  ~ You should have received a copy of the GNU Affero General Public License
  ~ along with this program. If not, see https://www.gnu.org/licenses/.
  -->
<div class="candidate-card" *ngIf="!!candidate" xmlns="http://www.w3.org/1999/html">
  <div class="content">

    <tc-icon
      [type]="'button'"
      (click)="close()"
      [color]="'gray'"
      [size]="'md'"
      style="position: absolute; top: 1.5rem; right: 2rem; cursor: pointer"
    >
      <i class="fa-solid fa-xmark"></i>
    </tc-icon>

    <!-- CANDIDATE SOURCE-SPECIFIC -->
    <div *ngIf="isContextNoteDisplayed()" class="list-specific">
      <div class="candidate-header" >
        <h5 *ngIf="isList">List Specific</h5>
        <h5  *ngIf="isContextNoteDisplayed() && !isList">Search Specific</h5>
      </div>

      <tc-tabs [activeTabId]="activeContextTabId" (tabChanged)="onContextTabChanged($event)">

        <!-- CONTEXT NOTES -->
        <tc-tab [id]="'contextNotes'">
          <tc-tab-header>Context Notes</tc-tab-header>
          <tc-tab-content>
            <app-candidate-context-note
              [candidate]="candidate"
              [candidateSource]="candidateSource"
            ></app-candidate-context-note>
          </tc-tab-content>
        </tc-tab>

        <!-- SHAREABLE DOCS -->
        <tc-tab *ngIf="canViewPrivateInfo()" [id]="'docs'">
          <tc-tab-header>
            {{isList ? "List-Specific " : null}}Shareable Docs
          </tc-tab-header>
          <tc-tab-content>
            <app-shareable-docs
              [candidate]="candidate"
              [candidateSource]="candidateSource">
            </app-shareable-docs>
          </tc-tab-content>
        </tc-tab>

        <!-- PREVIEW CV -->
        <tc-tab *ngIf="canViewPrivateInfo()" [id]="'cv'">
          <tc-tab-header>Preview CV</tc-tab-header>
          <tc-tab-content>
            <app-cv-preview
              [candidate]="candidate">
            </app-cv-preview>
          </tc-tab-content>
        </tc-tab>

        <!-- PROGRESS -->
        <tc-tab *ngIf="isSubmissionList()" [id]="'progress'">
          <tc-tab-header>Progress</tc-tab-header>
          <tc-tab-content>
            <app-opportunity-stage-next-step
              [opp]="getCandidateOppForJobSource()"
              [notEditable]="true">
            </app-opportunity-stage-next-step>
          </tc-tab-content>
        </tc-tab>
      </tc-tabs>
    </div>

    <hr *ngIf="isContextNoteDisplayed()" class="my-4">

    <!-- HEADER -->
    <div class="candidate-header mt-3">
      <h3>{{candidate.user?.firstName}} {{candidate.user?.lastName}}
        <span class="text-muted me-2">
          {{candidate.candidateNumber}} - {{candidate.status | titlecase}}
        </span>
        <a target="_blank" [routerLink]="['/candidate',candidate.candidateNumber]">
          <i class="fas fa-external-link-alt" title="Show candidate in new tab"></i>
        </a>
      </h3>
    </div>

    <tc-button *ngIf="canSeeJobDetails()"
               (onClick)="toggleNotes()"
               [type]="'plain'"
               [color]="'secondary'"
               [size]="'sm'"
    >
      General Notes
      <i class="fas"
         [ngClass]="showNotes ? 'fa-chevron-up' : 'fa-chevron-down'">
      </i>
    </tc-button>

    <!-- AUTO-UPDATING SHAREABLE NOTES -->
    <div *ngIf="showNotes && canSeeJobDetails()"
                  class="mt-2"
    >
      <app-candidate-shareable-notes
        [candidate]="candidate"
        [editable] = "isEditable()"
      ></app-candidate-shareable-notes>
    </div>

    <!-- GENERIC CANDIDATE PROFILE TABS -->
    <div class="mt-2">
      <tc-tabs [activeTabId]="activeTabId"
               (tabChanged)="onTabChanged($event)"
      >

        <!-- GENERAL -->
        <tc-tab [id]="'general'">
          <tc-tab-header>General</tc-tab-header>
          <tc-tab-content>
            <app-candidate-general-tab
              [candidate]="candidate"
              [editable]="false"
              [adminUser]="isAnAdmin()"
              [compact]="true"
            ></app-candidate-general-tab>
          </tc-tab-content>
        </tc-tab>

        <!-- EXPERIENCE -->
        <tc-tab [id]="'experience'">
          <tc-tab-header>Experience</tc-tab-header>
          <tc-tab-content>
            <app-candidate-experience-tab
              [candidate]="candidate"
              [editable]="false"
              [adminUser]="isAnAdmin()">
            </app-candidate-experience-tab>
          </tc-tab-content>
        </tc-tab>

        <!-- EDUCATION -->
        <tc-tab [id]="'education'">
          <tc-tab-header>Education</tc-tab-header>
          <tc-tab-content>
            <app-candidate-education-tab
              [candidate]="candidate"
              [editable]="false"
              [adminUser]="isAnAdmin()">
            </app-candidate-education-tab>
          </tc-tab-content>
        </tc-tab>

        <!-- ADDITIONAL INFO -->
        <tc-tab [id]="'additional'">
          <tc-tab-header>Additional Info</tc-tab-header>
          <tc-tab-content>
            <app-candidate-additional-info-tab
              [candidate]="candidate"
              [editable]="false"
              [canViewPrivateInfo]="canViewPrivateInfo()"
              [compact]="true"
            ></app-candidate-additional-info-tab>
          </tc-tab-content>
        </tc-tab>

        <!-- TASKS -->
        <tc-tab [id]="'tasks'" *ngIf="canViewPrivateInfo()">
          <tc-tab-header>Tasks</tc-tab-header>
          <tc-tab-content>
            <app-candidate-task-tab
              [candidate]="candidate"
              [editable]="false">
            </app-candidate-task-tab>
          </tc-tab-content>
        </tc-tab>

        <!-- NOTES -->
        <tc-tab [id]="'notes'" *ngIf="canViewPrivateInfo()">
          <tc-tab-header>Notes</tc-tab-header>
          <tc-tab-content>
            <app-candidate-history-tab
              [candidate]="candidate"
              [characterLimit]="100"
              [editable]="false">
            </app-candidate-history-tab>
          </tc-tab-content>
        </tc-tab>

        <!-- JOBS -->
        <tc-tab *ngIf="canSeeJobDetails()" [id]="'jobs'">
          <tc-tab-header>Jobs</tc-tab-header>
          <tc-tab-content>
            <app-candidate-jobs-tab
                [candidate]="candidate"
                [preview]="true">
            </app-candidate-jobs-tab>
          </tc-tab-content>
        </tc-tab>

      </tc-tabs>
    </div>

  </div>
</div>
