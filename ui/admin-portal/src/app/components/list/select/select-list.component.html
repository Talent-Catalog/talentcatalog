<!--
  ~ Copyright (c) 2024 Talent Catalog.
  ~
  ~ This program is free software: you can redistribute it and/or modify it under
  ~ the terms of the GNU Affero General Public License as published by the Free
  ~ Software Foundation, either version 3 of the License, or any later version.
  ~
  ~ This program is distributed in the hope that it will be useful, but WITHOUT
  ~ ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  ~ FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero General Public License
  ~ for more details.
  ~
  ~ You should have received a copy of the GNU Affero General Public License
  ~ along with this program. If not, see https://www.gnu.org/licenses/.
  -->

<tc-modal [header]="title"
          [showCancel]="true"
          [actionText]="action"
          (onAction)="select()"
          [disableAction]="saving || (form.errors !== null)"
          [showClose]="true">

  <tc-alert type="danger" *ngIf="error">
    <div><strong>{{error}}</strong></div>
  </tc-alert>

  <form [formGroup]="form">

    <div class="btn-group" role="group" aria-label="Basic radio toggle button group">
      <input type="radio" class="btn-check" [formControlName]="'newList'" id="btnradio1" autocomplete="off" checked [value]="true">
      <label class="btn btn-outline-secondary" for="btnradio1">New List</label>
      <input type="radio" class="btn-check" [formControlName]="'newList'" id="btnradio2" autocomplete="off" [value]="false">
      <label class="btn btn-outline-secondary" for="btnradio2">Existing List</label>
    </div>

    <hr>

    <div *ngIf="!newList" >

      <tc-field class="mb-3">
        <tc-label>Existing list</tc-label>
        <ng-select
          class="tc-select tc-select--no-val-highlight"
          id="savedList"
          [items]="lists"
          [clearable]="false"
          [searchable]="true"
          placeholder="Select or type..."
          bindLabel="name"
          formControlName="savedList">
        </ng-select>
      </tc-field>

      <div *ngIf="selectedSubmissionList()" class="form-text mb-2">
        <span class="fw-bold">Note: </span>
        Adding candidate(s) to a submission list will create candidate opportunities.
        <br>
        Once added they cannot be removed from the submission list, however candidate
        opportunities can be closed.
        <br>
        Closed candidate opportunities are hidden unless checkbox 'view closed cases' is checked.
        <br>
        Submission list contents can't be replaced.
      </div>

      <tc-field *ngIf="!selectedSubmissionList() && isListMine()"
                class="mb-3"
                [checkbox]="true">
        <tc-label [for]="'replace'">
          Replace my existing list contents?
        </tc-label>
        <tc-input [type]="'checkbox'" [formControlName]="'replace'" [id]="'replace'"></tc-input>
      </tc-field>
    </div>

    <div *ngIf="newList">
      <tc-field class="mb-3">
        <tc-label [for]="'name'">Name</tc-label>
        <tc-input [type]="'text'"
                  [formControlName]="'newListName'"
                  [readonly]="loading"
                  [id]="'name'">
        </tc-input>
        <tc-alert type="warning" *ngIf="form.errors?.invalidName">
          <div>{{form.errors.invalidName}}</div>
        </tc-alert>
      </tc-field>

      <tc-field>
        <div class="d-flex align-items-baseline mb-3">
            <tc-label [for]="'name'" class="me-2">OR copy job name</tc-label>
            <app-joblink (jobSelection)="onJobSelection($event)" class="flex-fill"></app-joblink>
        </div>
      </tc-field>

    </div>

    <tc-field *ngIf="canChangeStatuses"
              [checkbox]="true"
              class="mb-3">
      <tc-label [for]="changeStatuses">
        Change status for all candidates
        {{action == "Save" ? "selected" : "in list"}}?
      </tc-label>
      <tc-input [type]="'checkbox'"
                [formControlName]="'changeStatuses'"
                [id]="'changeStatuses'">
      </tc-input>
    </tc-field>

    <div *ngIf="changeStatuses" class="mb-3">
      <app-candidate-status-selector
        [candidateStatus]="CandidateStatus.active"
        (statusInfoUpdate)="onStatusInfoUpdate($event)"
      >
      </app-candidate-status-selector>
    </div>

  </form>

</tc-modal>
