<!--
  ~ Copyright (c) 2021 Talent Beyond Boundaries.
  ~
  ~ This program is free software: you can redistribute it and/or modify it under
  ~ the terms of the GNU Affero General Public License as published by the Free
  ~ Software Foundation, either version 3 of the License, or any later version.
  ~
  ~ This program is distributed in the hope that it will be useful, but WITHOUT
  ~ ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  ~ FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero General Public License
  ~ for more details.
  ~
  ~ You should have received a copy of the GNU Affero General Public License
  ~ along with this program. If not, see https://www.gnu.org/licenses/.
  -->

<p class="text-muted" *ngIf="!loading && !attachments.length && !uploading">
  {{ 'REGISTRATION.ATTACHMENTS.EMPTYSTATE' | translate }}
</p>

<div class="attachments">
  <div class="mb-3" *ngFor="let attachment of attachments; let i = index;" [class.card]="!preview">

    <div class="text-right" *ngIf="!preview && attachment.createdBy.id == user?.id">
      <button class="btn btn-secondary btn-card"
              [disabled]="deleting"
              (click)="deleteAttachment(attachment)">
        <fa-icon class="d-flex" icon="edit" size="xs"></fa-icon>
      </button>
      <button class="btn btn-danger btn-card"
              [disabled]="deleting"
              (click)="deleteAttachment(attachment)">&times;</button>
    </div>

    <div class="row">

      <div class="col-12">

        <div class="form-group">
          <label>{{ 'REGISTRATION.ATTACHMENTS.LABEL.NAME' | translate }}
            <span *ngIf="downloading">
                ...
            </span>
          </label>
          <p>
            <!-- Non Google files - ie links and AWS files -
             we can just follow their urls-->
            <a *ngIf="attachment.type!==AttachmentType.googlefile"
               target="_blank" [href]="getAttachmentUrl(attachment)">
              {{attachment.name}}
            </a>
            <!-- With Google files we can't link to the Google Shared Drive
             because Google's security prevents that.
             So instead, we download a copy of the file to the browser computer
             and show that-->
            <a *ngIf="attachment.type===AttachmentType.googlefile"
               (click)="downloadCandidateAttachment(attachment)"
               target="_blank" class="is-link">
              {{attachment.name}}
            </a>
          </p>
        </div>

      </div>

      <div class="col-12 col-md-6">

        <div class="form-group m-md-0">
          <label>{{ 'REGISTRATION.ATTACHMENTS.LABEL.CREATEDBY' | translate }}</label>
          <p *ngIf="attachment.createdBy && attachment.createdBy.id == user?.id">{{attachment.createdBy.firstName}} {{attachment.createdBy.lastName}}</p>
          <p *ngIf="attachment.createdBy && attachment.createdBy.id !== user?.id">Admin</p>
          <p *ngIf="!attachment.createdBy">Unknown</p>
        </div>

      </div>

      <div class="col-12 col-md-6">

        <div class="form-group m-md-0">
          <label>{{ 'REGISTRATION.ATTACHMENTS.LABEL.CREATEDDATE' | translate }}</label>
          <p>{{attachment.createdDate | date}}</p>
        </div>

      </div>

    </div>

    <hr *ngIf="preview && i < attachments?.length - 1">

  </div>
</div>

<app-error [error]="error"></app-error>

<app-file-upload *ngIf="!preview && !loading" [uploading]="uploading" (uploadStarted)="startServerUpload($event)"></app-file-upload>



